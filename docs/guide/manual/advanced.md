# 进阶知识

本章节将介绍一些必备的进阶知识，帮助你更好的认识 OPQ 的运作。

## 关于 token

### 自动登录

一个 token 绑定一个账号，一旦第一次扫码登录了，第二次启动程序就会自动登录，不需要再扫码了。

### 使用其他账号

如果要使用其他账号，请再去申请一个新 token ，用一份从压缩包（指最初下载的运行包）解压出来新的文件夹再进行配置，因为使用过的文件夹会被污染。

### 取消自动登录

如果你要放弃使用，请在 手机端 QQ > 设备管理 取消机器人设备，这样就不会再自动登陆了。

## 进程查看

我们在上文提到了使用 `nohup` 进行后台运行，我们可以使用 `htop` 查看进程运行情况：

```bash
    htop
```

之后就可以查看到该进程的资源占用情况了，按 F10 退出。

注：如果是 centos ，可能没有安装 htop ，如果需要使用，请自行安装。

## 日志查看

我们在上文提到了使用 `nohup` 进行后台运行，我们可以用如下方式查看我们的日志。

### 宝塔控制面板查看

直接在宝塔内点击查看文件即可，但是宝塔不支持查看大文件，超过 3 M 后即不支持打开。

### tail 查看

使用 `tail` 命令查看实时日志：

```bash
    tail -f nohup.out
```

查看最后 10 行日志：

```bash
    tail nohup.out
```

### cat 查看

使用 `cat` 命令查看全部日志：

```bash
    cat nohup.out
```

注意太多可能会控制台爆炸，不建议使用。

### 日志定位

先找到这条消息的行数：

```bash
    tail -n 1000 nohup.out | grep "关键词"
```

通过 `tail` 展示文件最后 1000 行，并通过 `grep` 搜索含 `关键词` 的日志，这里的 `关键词` 可以是任意内容，比如用户名，账号，群组名，消息关键词等。`-n` 表示显示行号。

再找到该行之后的消息，假设该消息在 11141 行：

```bash
    cat -n nohup.out | tail -n +11141 | head -n 30
```

用 `cat` 取全部日志，再使用 `tail` 查看 1234 行后的所有日志，再用 `head` 命令取 1234 行后的前 30 行：

![/manual/error.jpg](/manual/error.jpg)

如此一来，就发现了错误位置。

## 防火墙

我们部署在服务器上的机器人，如果其他人知道你服务器的 ip 是很危险的，他可以通过相应的网址查看到你的控制台和机器人信息，如果需要，可以在 宝塔面板 > 安全 内关闭机器人部署的端口（默认是 `8888`）。

## 宝塔面板配置

可视化面板很简单，请自行探索和百度，密码忘了请使用 shell 工具链接服务器后执行 `bt` 命令修改：

```bash
    bt
```